<%
const patternT0 = {
	$: {
		size: 3,
		color: 'info',
		align: 'center',
		bold: 'font-weight-bold',
	},
	"b": {
		size: 3,
		color: 'success',
		align: 'center',
		bold: '',
	},
	"c": {
		size: 3,
		color: 'danger',
		align: 'center',
		bold: 'font-weight-bold'
	},
};
function t0(pattern, data) {
	if (!data) return;
	let s = patternT0[pattern] || patternT0.$;
	let {size, color, align, bold} = s;
%>
	<h<%=size%> class="text-<%=color%> text-<%=align%> px-5 mb-3 pt-3 pb-3 
		border-bottom border-muted <%=bold%>">
    	<%-esc(data)%>
	</h3>
<%
}

const patternT1 = {
	$: {
		size: 4,
		color: 'info',
		align: 'left',
		bold: 'font-weight-bold',
	},
	"b": {
		size: 4,
		color: 'success',
		align: 'left',
		bold: '',
	},
	"c": {
		size: 4,
		color: 'danger',
		align: 'left',
		bold: 'font-weight-bold'
	},
};
function t1(pattern, data) {
	if (!data) return;
	let s = patternT1[pattern] || patternT1.$;
	let {size, color, align, bold} = s;
%>
	<h<%=size%> class="text-<%=color%> text-<%=align%> px-5 mt-3 mb-4 pt-3 pb-2 
		border-bottom border-muted
		<%=bold%>">
    	<%-esc(data)%>
	</h3>
<%
}

const patternT2 = {
	$: {
		size: 5,
		color: 'info',
		align: 'left',
		bold: 'font-weight-bold',
	},
	"b": {
		size: 5,
		color: 'success',
		align: 'left',
		bold: '',
	},
	"c": {
		size: 5,
		color: 'danger',
		align: 'left',
		bold: 'font-weight-bold'
	},
};
function t2(pattern, data) {
	if (!data) return;
	let s = patternT2[pattern] || patternT2.$;
	let {size, color, align, bold} = s;
%>
	<h<%=size%> class="text-<%=color%> text-<%=align%> px-5 mt-3 mb-4 pt-3 pb-2 
		border-bottom border-muted
		<%=bold%>">
    	<%-esc(data)%>
	</h3>
<%
}

const patternT3 = {
	$: {
		size: 6,
		color: 'info',
		align: 'left',
		bold: 'font-weight-bold',
	},
	"b": {
		size: 6,
		color: 'success',
		align: 'left',
		bold: '',
	},
	"c": {
		size: 6,
		color: 'danger',
		align: 'left',
		bold: 'font-weight-bold'
	},
};
function t3(pattern, data) {
	let s = patternT3[pattern] || patternT3.$;
	let {size, color, align, bold} = s;
%>
	<h<%=size%> class="text-<%=color%> text-<%=align%> px-5 mt-3 mb-4 pt-3 pb-2 
		border-bottom border-muted
		<%=bold%>">
    	<%-esc(data)%>
	</h3>
<%
}

const patternGrid = {
	$: {
		gridClass: 'row row-cols-1 row-cols-sm-1 row-cols-md-3',
	},
	b: {
		gridClass: 'row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4',
	}
}
function cell(pattern, data, arr) {
%>
	<div>cell <%-esc(data)%></div>
<%
}
function grid(pattern, data, cellFunc) {
	let s = patternGrid[pattern] || patternGrid.$;
	let {gridClass} = s;
	let tf = eval('typeof ' + cellFunc);
	if (tf === 'function') {
%> <div class="container">
	<div class="<%=gridClass%>">
<%
	let func = eval(cellFunc);
	data.forEach(v => {
		let main, arr;
		let v0 = v[0];
		if (Array.isArray(v0)) {
			main = v0;
			arr = v[1];
		}
		else {
			main = v;
		}
		if (arr === undefined) arr = [];
		func(pattern, main, arr)
	});
%> </div></div> <%
	}
	else {
%>
		<div class="text-danger"><b>Error: </b>#grid '<%=cellFunc%>' is <%=tf%>, is not function</div>
<%
	}
}

const patternTable = {
	$: {
		tableClass: 'table table-striped table-hover border-top my-3 table-bordered',
	}
}
function table(pattern, data) {
	let {tableClass} = patternTable[pattern] || patternTable.$;
	let len=data.length;
	if (len===0) return;
	let align = [];
%>
	<table class="<%=tableClass%>">
	<thead><tr>
<%
	let r0 = data[0];
	for (let j=0; j<r0.length; j++) {
		let c = r0[j];
		let a;
		if (c.endsWith('|') === true) {
			a = 'text-right';
			c = c.substr(0, c.length-1);
		}
		else if (c.startsWith('|') === true) {
			c = c.substr(1);
		}
		else {
			a = 'text-center';
		}
		align.push(a);
		%> <th class="<%=a%>""><%-esc(c)%></th> <%
	};
%> 
	</tr></thead>
	<tbody>
<%
	for (let i=1; i<len; i++) {
		let r = data[i];
		%> <tr> <%
		for (let j=0; j<r.length; j++) {
			let c = r[j];
			%> <td class="<%=align[j]%>"><%-esc(c)%></td> <%
		}
		%> </tr> <%
	}
%>
	</tbody></table>
<%
}


function xl(ou, pattern, data, type) {
	if (!data || data.length === 0) return;
%>
	<<%=ou%> type="<%=type%>">
<%
		data.forEach(v => {
%>
			<li><%-esc(v)%></li>
<%			
		})
%>
	</<%=ou%>>
<%
}
function ul(pattern, data) {
	xl('ul', pattern, data);
}

function ol(pattern, data) {
	xl('ol', pattern, data);
}

function ouou(l1, l2, pattern, data, type1, type2) {
	if (!data || data.length === 0) return;
%>
	<<%=l1%> type="<%=type1%>">
<%
		data.forEach(v => {
%>
			<li>
				<%- esc(v[0]) %>
				<% xl(l2, pattern, v[1], type2) %>
			</li>
<%			
		})
%>
	</<%=l1%>>
<%
}

function ulul(pattern, data) {
	ouou('ul', 'ul', pattern, data, 'square', 'circle');
}

function ulol(pattern, data) {
	ouou('ul', 'ol', pattern, data);
}

function olul(pattern, data) {
	ouou('ol', 'ul', pattern, data);
}

function olol(pattern, data) {
	ouou('ol', 'ol', pattern, data, '', 'a');
}

function hr(pattern) {
%>
	<hr>
<%
}

const patternP = {
	$: {
		first: 'first-char-large first-line-height-small',
		other: ''
	},
	b: {
		first: 'first-char-large first-line-height-small',
		other: 'first-char-large first-line-height-small'
	},
	c: {
		first: '',
		other: ''
	}
}
function p(pattern, data) {
	let {first, other} = patternP[pattern] || patternP.$;
	let line0 = true;
	data.forEach(v => {
		%><p class="<%=line0===true?first:other%>"><%-esc(v)%></p><%
		line0 = false;
	})
}

function raw(pattern, data) {
	if (!data) return;
	data.forEach(v => {
	%>
		<%-esc(v)%>
	<%
	})
}


const patternImage = {
	$: {
		divClass: 'w-75 my-3 text-center mx-auto',
		imgClass: 'border border-muted w-100 p-3 mb-2',
		textClass: 'small text-muted',
	},
	"float-right": {
		divClass: 'w-50 my-3 ml-3 text-center float-right',
		imgClass: 'border border-muted w-100 p-3 mb-2',
		textClass: 'small text-muted',
	},
	"float-left": {
		divClass: 'w-50 my-3 mr-3 text-center float-left',
		imgClass: 'border border-muted w-100 p-3 mb-2',
		textClass: 'small text-muted',
	}
}
function image(pattern, data) {
	let {divClass, textClass, imgClass} = patternImage[pattern] || patternImage.$;
	let [l0, l1, l2] = data;
	let v0 = Array.isArray(l0)===true? l0[0] : l0;
	let v1 = Array.isArray(l1)===true? l1[0] : l1;
	let v2 = Array.isArray(l2)===true? l2[0] : l2;
%>
	<div class="<%=divClass%>">
	<% if (v2) { %>
		<a href="<%=v2%>">
	<% } %>
		<img class="<%=imgClass%>" src="<%=v0%>" alt="">
		<div class="<%=textClass%>"><%=v1%></div>
	<% if (v2) { %>
		</a>
	<% } %>
	</div>
<%
}


%>
